---
title: API Gateway, Lambda, and DynamoDB
layout: page
course: AWS Cloud Fundamentals
courselanding: /aws1/lessons/
session: 6
---

<div id="wrapper">
  <nav id="toc">
    <small><a style="font-style: italic" href="javascript:history.back()" title="">< back</a></small>
    <ol>
      <li><a href="#logistics">Logistics</a></li>
      <li><a href="#agenda">Agenda & Goals</a></li>
      <li><a href="#cleanup">Cleanup</a></li>
      <li><a href="#selfstudy">Self-Study Exercises</a></li>
    </ol>
  </nav>
  <div id="content-container">
    <section>
      <img class="section-image" src="{{ site.url }}/assets/images/turing-logo-white.png" alt="Turing logo">
      <h2 class="section-header">This Session's Setup</h2>
      <p>Open up the <a href="http://console.aws.amazon.com">AWS Mangement Console</a> and login to your AWS account using the admin user you created in the setup. <b>Do not log into your root account.</b></p>
      <p>At the top of your Management Console next to your username, you'll see "Ohio" listed as your region. Go ahead and change that to US East (N. Virginia).</p>
    </section>
    <hr>
    <section>
      <a name="logistics"></a>
      <img class="section-image" src="{{ site.url }}/assets/images/logistics.svg" alt="Checklist">
      <h2 class="section-header">Logistics and Expectations</h2>
      <ol>
        <li>In this session, we'll dive into the practical side of creating a DynamoDB table and accessing it programatically. We will not be going over the theory behind NoSQL databases. However, as always, we've included links to additional resources you can use to further your learning once you understand the fundamentals.</li>
        <li>Use the <a target="blank" href="https://docs.google.com/document/d/1dyEaYh-OAaUiqfq7V1cxeeceQzGWbRIx_nHclqTISco/edit?usp=sharing">Parking Lot</a> to jot down questions you have that are not part of the course.</li>
        <li>Play your part in creating a safe and welcoming learning environment for your classmates.</li>
      </ol>
    </section>
    <hr>
    <section>
      <a name="agenda"></a>
      <img class="section-image" src="{{ site.url }}/assets/images/goals.svg" alt="Target">
      <h2 class="section-header">Agenda and Goals</h2>
      <ul>
        <li>Understand the purpose and basic functionality of DynamoDB</li>
        <li>Create and configure a DynamoDB table</li>
        <li>Get all data from a DynamoDB table using Lambda</li>
        <li>Get a single piece of data from a DynamoDB table using Lambda</li>
        <li>Post data to a DynamoDB table using Lamdba</li>
      </ul>
    </section>
    <hr />
    <section>
      <a name="dynamoOV"></a>
      <img class="section-image" src="{{ site.url }}/assets/images/dynamodb.svg" alt="AWS DynamoDB icon">
      <h2 class="section-header">DynamoDB Overview</h2>
      <h4>From <a target="blank" href="">AWS:</a></h4>
      <blockquote><small>Amazon DynamoDB is a fully managed NoSQL database service that provides fast and predictable performance with seamless scalability. DynamoDB lets you offload the administrative burdens of operating and scaling a distributed database so that you don't have to worry about hardware provisioning, setup and configuration, replication, software patching, or cluster scaling.</small></blockquote>
      <p>DynamoDB is a good complement to Lambda and API Gateway since it's also serverless. Since DynamoDB is a NoSQL database, there are no relationships between tables, and therefore it is likely not a good choice for an application that is relationship-heavy.</p>
      <h4>Features of DynamoDB</h4>
      <ul>
        <li>Like RDS, DynamoDB is a fully-managed database. This means that you do not need to do any provisioning, software management/patching, security, replication, scaling, etc.</li>
        <li>Because it is serverless, it can be considered "infinitely scalable"</li>
        <li>Extremely fast with low latency</li>
        <li>Automatically replicated across Availability Zones</li>
      </ul>
      <h4>Structure</h4>
      <p>With DynamoDB, you <b>do not</b> need to create a database. Instead, you create just a table. You can learn more about data modeling in the additional resources section, but generally you will find that one microservice would access one DynamoDB table.</p>
      <p>A DynamoDB table is key-value based and doesn't have a schema. Instead, you can create keys on the fly, and not all of the items in the database need to have the same keys. For example, these could be two items in the same table:</p>
      <pre>{
  "id": "1",
  "name": "Rachel",
  "pets": [
    { 
      "name": "Beeba",
      "type": "kitten"
    }
  ]
}</pre>
<pre>{
  "id": "2",
  "name": "Mike",
  "address": "1234 Turing Ln."
}</pre>
      <p>A table needs to have a <span class="vocab">partition key</span> (or primary key) specified at creation. This is the only field that a table must have. A partition key should be something where there are many possible values to avoid a "hot partition" issue.</p>
      <p>In addition to a primary key, you can specify a <span class="vocab">sort key</span> that Dynamo uses for ordering the data once it's in the partition. The diagram below shows a sort key being used in conjunction with a partition key.</p>
      <img class="screenshot" src="{{site.url}}/assets/images/partitionsort.png" alt="Screenshot for Dynamo Partitions and sort keys">
      <p>Either the partition key must be unique, OR the combination of the partition key + the sort key must be unique.</p>
      <p>When setting up a table, you must specify your read and write capacity units, which indicate how often you plan to read or write data <b>per second</b>. One read capacity unit (RCU) represents 1 strongly consistent read at 4kb/sec (or 2 eventually consistent reads at 4kb/sec), and 1 write capacity unit (WCU) represents 1 write for 1kb/sec.</p>
      <p>Data in a DynamoDB table is automatically encrypted at rest.</p>
      <h4>Additional Resources</h4>
      <ul>
        <li><a target="blank" href="https://www.youtube.com/watch?v=Rmf8mrJ3X2s">Intro to NoSQL Data Modeling with Amazon DynamoDB</a></li>
        <li><a target="blank" href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/HowItWorks.Partitions.html">How Partitions Work</a></li>
        <li><a target="blank" href="https://aws.amazon.com/blogs/database/how-to-determine-if-amazon-dynamodb-is-appropriate-for-your-needs-and-then-plan-your-migration/">How to determine if Amazon DynamoDB is appropriate for your needs</a></li>
      </ul>
    </section>
    <hr>
    <section>
      <h2 class="section-header">Creating a DynamoDB Table</h2>
      <br>
      <div class="together">
        <h4>Together: DynamoDB Tables and Items</h4>
        <p>In this section, we'll create a <code>pets</code> DynamoDB table with an <code>id</code> attribute and a <code>name</code> attribute. Let's head into the Management Console.</p>
      </div>
      <h4>Additional Resources</h4>
      <ul>
        <li><a target="blank" href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/bp-query-scan.html">Scans vs. Queries</a></li>
      </ul>
    </section>
    <hr>
    <section>
      <h2 class="section-header">Using Lambda to Access DynamoDB Data</h2>
      <p>In this section, we'll rewrite our Lambda functions to use the SDK to access DynamoDB data and return it to our API Gateway.</p>
      <p>First, let's update our <code>allPets</code> function. We'll need to grant the role permission to access DynamoDB. Then, we can change the code:</p>
      <pre>require 'aws-sdk-dynamodb'

def lambda_handler(event:, context:)
    dynamodb = Aws::DynamoDB::Client.new(region: 'us-east-1')
    result = dynamodb.scan({ table_name: 'pets' })
    { statusCode: 200, body: result }
end
</pre>
      <p>Next, we'll update the code to create a pet in <code>createPet</code>. We'll need to grant the role permission to access DynamoDB. Then, update the code:</p>
      <pre>require 'aws-sdk-dynamodb'

def lambda_handler(event:, context:)
    dynamodb = Aws::DynamoDB::Client.new(region: 'us-east-1')

    dynamodb.put_item({
      table_name: 'pets',
      item: {
        "id" => event["id"].to_i,
        "name" => event["name"]
      }
    })
    { statusCode: 200, body: "You created pet #{event["id"]} named #{event["name"]}" }
end</pre>
      <p>Finally, we'll change the code to find a specific pet by ID in <code>onePet</code>. We'll need to grant the role permission to access DynamoDB. Then, update the code:</p>
      <pre>require 'aws-sdk-dynamodb'

def lambda_handler(event:, context:)
    dynamodb = Aws::DynamoDB::Client.new(region: 'us-east-1')
    id = event["id"].to_i
    result = dynamodb.get_item({
      table_name: 'pets',
      key: { 'id' => id }
    })
    { statusCode: 200, body: "You found #{result[:item]}" }
end</pre>
    </section>
    <hr>
    <section>
      <a name="cleanup"></a>
      <img class="section-image" src="{{ site.url }}/assets/images/cleaning.svg" alt="Mop and bucket">
      <h2 class="section-header">Cleanup</h2>
      <ol>
        <li>Delete the S3 bucket that is hosting your static files</li>
        <li>Delete all of your Lambda functions.</li>
        <li>Delete your API gateway.</li>
        <li>Delete your DynamoDB table.</li>
        <li>Delete any IAM roles related to your Lambda functions, API Gateway, or DynamoDB table.</li>
      </ol>
    </section>
    <hr />
  </div>
</div>
<script
src="https://code.jquery.com/jquery-3.2.1.min.js"
integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
crossorigin="anonymous"></script>